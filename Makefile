# ==========================================
# CastOut-Engine Makefile (Fixed & Optimized)
# ==========================================

TARGET = CastOut-Engine

# –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ —Ñ–ª–∞–≥–∏
CXX = g++
# -MMD –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç .d —Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ö–µ–¥–µ—Ä–∞—Ö (.hpp)
CXXFLAGS = -Wall -Wextra -std=c++17 -I./headers -I./engine -I./game -MMD
LDFLAGS = -lsfml-graphics -lsfml-window -lsfml-system -lm

# –ü–∞–ø–∫–∏
SRC_DIR = src
OBJ_DIR = obj

# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö .cpp —Ñ–∞–π–ª–æ–≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
SRCS = $(shell find $(SRC_DIR) -name "*.cpp")

# –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç–∏ –¥–ª—è –æ–±—ä–µ–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (src/main.cpp -> obj/main.o)
OBJS = $(patsubst $(SRC_DIR)/%.cpp, $(OBJ_DIR)/%.o, $(SRCS))
DEPS = $(OBJS:.o=.d)

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å
GREEN = \033[0;32m
YELLOW = \033[0;33m
NC = \033[0m # No Color

# –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å: –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–µ—Ä–∏ 'make', —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
all: $(TARGET)

# –°–±–æ—Ä–∫–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
$(TARGET): $(OBJS)
	@echo "$(GREEN)üîó –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ $(TARGET)...$(NC)"
	$(CXX) $(OBJS) -o $(TARGET) $(LDFLAGS)
	@echo "$(GREEN)‚úÖ –ì–æ—Ç–æ–≤–æ!$(NC)"

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è .cpp –≤ .o
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	@mkdir -p $(dir $@)
	@echo "$(YELLOW)üî® –ö–æ–º–ø–∏–ª—è—Ü–∏—è $<...$(NC)"
	$(CXX) $(CXXFLAGS) -c $< -o $@

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç–µ–ø–µ—Ä—å run –ó–ê–í–ò–°–ò–¢ –æ—Ç $(TARGET))
# –ï—Å–ª–∏ —Ç—ã –∏–∑–º–µ–Ω–∏–ª –∫–æ–¥, make —Å–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –µ–≥–æ, –∞ –ø–æ—Ç–æ–º –∑–∞–ø—É—Å—Ç–∏—Ç
run: $(TARGET)
	@echo "$(GREEN)üöÄ –ó–∞–ø—É—Å–∫ $(TARGET)...$(NC)"
	@./$(TARGET) || echo "$(YELLOW)‚ö†Ô∏è  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å. –ü–æ—Å–º–æ—Ç—Ä–∏ –æ—à–∏–±–∫–∏ –≤—ã—à–µ.$(NC)"

# –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø–∞–ø–∫–∏ $(OBJ_DIR) –∏ —Ñ–∞–π–ª–∞ $(TARGET)..."
	rm -rf $(OBJ_DIR) $(TARGET)

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—á—Ç–æ–±—ã hpp –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–∂–µ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª–∏—Å—å)
-include $(DEPS)

.PHONY: all run clean